pssh () {
    HOSTFILE="ips.txt"

    [ -f $HOSTFILE ] || {
        echo "No hostfile found at $HOSTFILE"
        return
    }

    echo "* parallel-ssh-ing: $@"

    parallel-ssh -h $HOSTFILE -l ubuntu \
    -O UserKnownHostsFile=/dev/null -O StrictHostKeyChecking=no \
    -O ForwardAgent=yes \
    "$@"
}

pcopykey () {
    echo "Copying our key to ubuntu/.ssh/authorized_keys"
    ssh-add -L | pssh --askpass --send-input \
            "mkdir -p /home/ubuntu/.ssh; tee /home/ubuntu/.ssh/authorized_keys"

    echo "Copying our key to docker/.ssh/authorized_keys"
    ssh-add -L | pssh --askpass --send-input \
            "mkdir -p /home/docker/.ssh; tee /home/docker/.ssh/authorized_keys"

    echo "Copying our key to /root/.ssh/authorized_keys"
    ssh-add -L | pssh --send-input \
        "sudo mkdir -p /root/.ssh; sudo tee /root/.ssh/authorized_keys"

    #"mkdir -p .ssh; tee .ssh/authorized_keys"
}
